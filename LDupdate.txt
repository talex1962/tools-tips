UPDATING A LITTLE DEVICE
------------------------

NOTE: login to 192.168.1.1 or 192.168.2.1 as 'ld-admin', password 'friday' for all commands
NOTE: the sudo password is 'friday'

1. Update the LD source tree

    cd /home/ld-admin/src/ld
    git pull origin
        -- Git password is 'friday44'

2. Update the local JSON databases

    cd /home/ld-admin/src/ld/littledev/db
    python LDDB.py
    python LANDB.py
    python diskDB.py

3. Move new Python functions to /usr/local/lib/ld, and new JSON DBs to /var/lib/ld/db

    -- stop the manager daemons
    sudo supervisorctl
        supervisor> stop all
        supervisor> status
        supervisor> exit

    -- copy over the various files to their various locations
    cd /home/ld-admin/src/ld/littledev/db
    sudo cp -r /home/ld-admin/src/ld/libs/* /usr/local/lib/ld
    sudo cp -r /home/ld-admin/src/ld/littledev/* /usr/local/lib/ld
    sudo chown -R ld-admin:ld-admin /var/lib/ld /var/lib/ld/db
    sudo cp /usr/local/lib/ld/littledev/db/*.json /var/lib/ld/db
    sudo chown ld-admin:ld-admin /var/lib/ld/db/*.json
    sudo rm -f /usr/local/lib/ld/littledev/LDConfig.ini
    sudo cp /home/ld-admin/src/ld/littledev/LDConfig.ini /usr/local/etc

    -- edit LDConfig.ini in /usr/local/etc and adapt to new LD + system dirs
    sudo vi /usr/local/etc/LDConfig.ini
        -- modify the items listed below (LEAVE OTHERS ALONE!):
        fileLogLevel = INFO
        consoleLogLevel = WARNING
        LDDBFile = /var/lib/ld/db/LDDB.json
        LANConfigDBFile = /var/lib/ld/db/LANConfigDB.json
        LANStatusDBFile = /var/lib/ld/db/LANStatusDB.json
        diskConfigDBFile = /var/lib/ld/db/diskConfigDB.json
        diskStatusDBFile = /var/lib/ld/db/diskStatusDB.json

        [COMMSMGR]
        logFile = /var/log/commsManager.log
        GUID = 9876543210

        [LANMGR]
        logFile = /var/log/LANManager.log

        [DISKMGR]
        logFile = /var/log/diskManager.log

        [DEVICE0]
        type = AP
        IPAddr = 192.168.1.63

        [DEVICE1]
        type = switch
        IPAddr = 192.168.1.64

    -- restart the various manager daemons
    sudo supervisorctl
        supervisor> reread
        supervisor> update
        supervisor> restart
        supervisor> status
            -- this should show RUNNING for all three daemons
            -- now wait for 5 seconds and do
        supervisor> status
            -- this should still show RUNNING for all three daemons
            -- the process IDs should be the same as the previous display
        supervisor> exit

4. Final cleanup and reboot

    sudo reboot

5. Log in again as ld-admin and verify that the daemons are running

    ps aux | grep python
        -- should see lines with 'commsManager', 'diskManager', 'LANManager'

    NOTE: to stop the daemons:
        sudo supervisorctl
            supervisor> stop <daemon: commsManager, LANManager, diskManager>
                - or -
            supervisor> stop all

